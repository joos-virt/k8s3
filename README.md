# k8s3
Kubernetes практика

Оркестрация - процесс автоматического развертывания и управления контейнерами
- Docker swarm (не хватает функий для сложных приложений)
- Kubernetes (самый популярный, не сложный и многофункциональный)
- Mesos (сложный, но продвинутый)

Архитектура

Noda эта машина физическая или виртуально на которой установлен кубернетес 

Вокер нода это компьютер на котором кубернетес будет запускать контейнеры, раньше они назывались миньонами

Кластер это набор сгруппированых вместе узлов, таким образом даже если один узел падает то наше приложение по-прежнему доступно для пользователей, более того наличие нескольких nod также помогают распределению нагрузки

Мастер это еще одна нода член кубернетес сконфигурированая как мастер. У нее особые функции наблюдать за состоянием других нод и быть ответственным за оркестрацию контейнеров на воркер нодах

Компоненты:

- API SERVER - frontend - единый интерфейс Kubernetes, все общаются с api server
- CONTAINER RUNTIME - среда выполнения контейнера - базовое ПО используется для запуска контейнеров
- CONTROLLER - мозг оркестрации, смотрят за состоянием нод, контейнеров, endpoint-ов и ответственны за реакцию за события на нодах. Принимают решения о создании новых контейнеров.
- SCHEDULER - ответственнен за распределение работ или контейнеров между нодами, ожидает появления контейнера, чтобы назначить его выполнение на ноду
- Служба KUBELET - агент который работает на каждом узле кластера, агент отвечает за то чтобы контейнеры работали на узлах должным образом
- Служба ETCD - хранилище ключ-значение, распределенная надежная БД используемая kubernetes для хранения информации нужной для управления кластера. Когда в кластере несколько докер нод, несколько мастеров ETCD хранит свою информацию на всех нодах кластера распределенным образом и отвечают за реализацию блокировок, не допуская конфликты между мастерами

Отличия worker и master

Worker нода или миньон это сервер где размещены контейнеры, например докер контейнер. Для запуска контейнеров докер в системе должна быть установлена среда выполнения контейнера в данном случае это докер, но вовсе не обязательно должен быть он есть и другие контейнер runtime и такие как rkt или cri-o 

Minikube - одноузловой кластер для тестов

https://kubernetes.io/ru/docs/tasks/tools/install-kubectl/

Если установить kubectl перед миникуб то не нужно будет заниматься ее привязкой к кластеру миникуб это сделает за нас

https://kubernetes.io/ru/docs/tasks/tools/install-minikube/

Kubeadm необходимо
- Docker
- kubeadm
- Инициализация мастера
- POD Network
- Присоединение рабочих узолов к главному

**Простые абстракции**

Кубернетес не развертывает контейнеры непосредственно в ноды он инкапсулирует их в объекты которые называются поды

Под это отдельный экземпляр приложения, также под это самый маленький объект который ты можешь создать в кубернетес, самая маленькая деталь этого конструктора

В поде обычно один контейнер, в котором выполняются приложение, а чтобы отмасштабироваться вверх ты создаешь новые поды, а чтобы соскелиться вниз удаляешь существующие. Не стоит добавлять дополнительные контейнеры в существующие ноды для масштабирования приложения

В поде обычно один контейнер, но есть ли ограничение на запуск нескольких контейнеров в одном поде? Нет в одном поде может быть несколько контейнеров, но эти контейнеры не должны быть одного типа. В некоторых случаях требуется создать контейнер помощник который нес бы функции поддержки приложения из основного контейнера, такие как предпроцессинг введенных пользователем данных, обработка файлов загруженных пользователям или фиксация поведения приложения, главное требование для таких контейнеров, что время их жизни совпадает с продолжительностью работы основного контейнера с приложением. В этом случае оба контейнера буду частью одного пода и когда будет создан новый контейнер приложения, вместе будет создан помошник, а когда контейнер приложения умрет помощник тоже будет уничтожен вместе с подом.
```
kubectl run nginx --image nginx - ставим nginx
kubectl get pods - смотрим доступные поды
```





